!function(a,b){"use strict";"function"==typeof define&&define.amd?define("RowSorter",b):"object"==typeof exports?module.exports=b():a.RowSorter=b()}(this,function(){"use strict";function a(e,j){if(!(this instanceof a))return new a(e,j);if("string"==typeof e&&(e=k(e)),l(e,"table")===!1)throw new Error("Table not found.");return e[C]instanceof a?e[C]:(this._options=v(D,j),this._table=e,this._tbody=e,this._rows=[],this._lastY=!1,this._draggingRow=null,this._firstTouch=!0,this._lastSort=null,this._ended=!0,this._mousedown=u(b,this),this._mousemove=u(f,this),this._mouseup=u(h,this),this._scrollListener=u(d,this),this._touchstart=u(c,this),this._touchmove=u(g,this),this._touchend=u(i,this),this._touchId=null,this._table[C]=this,void this.init())}function b(a){return a=a||window.event,!this._start(a.target||a.srcElement,a.clientY)||(a.preventDefault?a.preventDefault():a.returnValue=!1,!1)}function c(a){if(1===a.touches.length){var b=a.touches[0],c=a.target||document.elementFromPoint(b.clientX,b.clientY);if(this._touchId=b.identifier,this._start(c,b.clientY))return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}return!0}function d(a){if(this._draggingRow){a=a||window.event,a.touches&&1===a.touches.length&&this._touchId===a.touches[0].identifier&&(a=a.touches[0]);var b=a.clientY,c=window.innerHeight,d=Math.max(0,Math.min(b,c-b));d<this._options.scrollSens?(this._scrollSpeed="function"==typeof this._options.scrollSpeed?this._options.scrollSpeed((this._options.scrollSens-d)/this._options.scrollSens):this._options.scrollSpeed,this._scrolling||(this._scrolling=!0,this._scrollDir=b<c-b?-1:1,e.call(this))):this._scrolling=!1}}function e(){this._scrolling&&this._draggingRow&&(document.body.scrollTop+=this._scrollSpeed*this._scrollDir,E(e.bind(this)))}function f(a){return a=a||window.event,this._move(a.target||a.srcElement,a.clientY),!0}function g(a){if(!this._drewThisFrame){if(1===a.touches.length){var b=a.touches[0];if(this._touchId===b.identifier){var c=document.elementFromPoint(b.clientX,b.clientY);this._move(c,b.clientY)}}return!0}}function h(){this._end()}function i(a){a.changedTouches.length>0&&this._touchId===a.changedTouches[0].identifier&&this._end()}function j(b){return b instanceof a?b:("string"==typeof b&&(b=k(b)),l(b,"table")&&C in b&&b[C]instanceof a?b[C]:null)}function k(a){var b=w(document,a);return b.length>0&&l(b[0],"table")?b[0]:null}function l(a,b){return a&&"object"==typeof a&&"nodeName"in a&&a.nodeName===b.toUpperCase()}function m(a,b,c){var d=a.parentNode;1===c?b.nextSibling?d.insertBefore(a,b.nextSibling):d.appendChild(a):c===-1&&d.insertBefore(a,b)}function n(a,b){for(var c=a.rows,d=c.length,e=0;e<d;e++)if(b===c[e])return e;return-1}function o(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)}function p(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)}function q(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function r(a,b){if(z)return z(a).hasClass(b);if(b=q(b),""===b)return!1;if(b.indexOf(" ")!==-1){for(var c=b.replace(/\s+/g," ").split(" "),d=0,e=c.length;d<e;d++)if(r(a,c[d])===!1)return!1;return!0}return a.classList?!!a.classList.contains(b):!!a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function s(a,b){if(b=q(b),""!==b)if(b.indexOf(" ")===-1)r(a,b)===!1&&(a.classList?a.classList.add(b):a.className+=" "+b);else for(var c=b.replace(/\s+/g," ").split(" "),d=0,e=c.length;d<e;d++)s(a,c[d])}function t(a,b){if(b=q(b),""!==b)if(b.indexOf(" ")===-1)r(a,b)&&(a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," "));else for(var c=b.replace(/\s+/g," ").split(" "),d=0,e=c.length;d<e;d++)t(a,c[d])}function u(a,b){return Function.prototype.bind?a.bind(b):function(){a.apply(b,A.slice.call(arguments))}}function v(a,b){if(z)return z.extend({},a,b);var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);if(b&&"[object Object]"===Object.prototype.toString.call(b))for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d}function w(a,b){return z?z.makeArray(z(a).find(b)):a.querySelectorAll(b)}function x(a,b){var c=1,d=20,e=a;for(b=b.toLowerCase();e.tagName&&e.tagName.toLowerCase()!==b;){if(c>d||!e.parentNode)return null;e=e.parentNode,c++}return e}function y(a,b){if(A.indexOf)return A.indexOf.call(a,b);for(var c=0,d=a.length;c<d;c++)if(b===a[c])return c;return-1}var z=window.jQuery||!1,A=Array.prototype,B=!!("ontouchstart"in document),C="data-rowsorter",D={handler:null,tbody:!0,tableClass:"sorting-table",dragClass:"sorting-row",stickTopRows:0,stickBottomRows:0,onDragStart:null,onDragEnd:null,onDrop:null,scrollSens:60,scrollSpeed:function(a){return 5+15*Math.pow(a,2)}};a.prototype.init=function(){if(this._options.tbody){var a=this._table.getElementsByTagName("tbody");a.length>0&&(this._tbody=a[0])}if("function"!=typeof this._options.onDragStart&&(this._options.onDragStart=null),"function"!=typeof this._options.onDrop&&(this._options.onDrop=null),"function"!=typeof this._options.onDragEnd&&(this._options.onDragEnd=null),("number"!=typeof this._options.stickTopRows||this._options.stickTopRows<0)&&(this._options.stickTopRows=0),("number"!=typeof this._options.stickBottomRows||this._options.stickBottomRows<0)&&(this._options.stickBottomRows=0),o(this._table,"mousedown",this._mousedown),o(document,"mouseup",this._mouseup),B&&(o(this._table,"touchstart",this._touchstart),o(this._table,"touchend",this._touchend)),"onselectstart"in document){var b=this;o(document,"selectstart",function(a){var c=a||window.event;if(null!==b._draggingRow)return c.preventDefault?c.preventDefault():c.returnValue=!1,!1})}},a.prototype._start=function(a,b){if(this._draggingRow&&this._end(),this._rows=this._tbody.rows,this._rows.length<2)return!1;if(this._options.handler){if(a.matches&&!a.matches(this._options.handler))return!1;var c=w(this._table,this._options.handler);if(!c||y(c,a)===-1)return!1}var d=x(a,"tr"),e=n(this._tbody,d);return!(e===-1||this._options.stickTopRows>0&&e<this._options.stickTopRows||this._options.stickBottomRows>0&&e>=this._rows.length-this._options.stickBottomRows)&&(this._draggingRow=d,this._options.tableClass&&s(this._table,this._options.tableClass),this._options.dragClass&&s(this._draggingRow,this._options.dragClass),this._oldIndex=e,this._options.onDragStart&&this._options.onDragStart(this._tbody,this._draggingRow,this._oldIndex),this._lastY=b,this._ended=!1,o(this._table,"mousemove",this._mousemove),o(document.body,"mousemove",this._scrollListener),B&&(o(this._table,"touchmove",this._touchmove),o(document.body,"touchmove",this._scrollListener)),!0)},a.prototype._move=function(a,b){if(this._draggingRow&&!this._drewThisFrame){this._drewThisFrame=!0,E(function(){this._drewThisFrame=!1}.bind(this));var c=b>this._lastY?1:b<this._lastY?-1:0;if(0!==c){var d=x(a,"tr");if(d&&d!==this._draggingRow&&y(this._rows,d)!==-1){var e=!0;if(this._options.stickTopRows>0||this._options.stickBottomRows>0){var f=n(this._tbody,d);(this._options.stickTopRows>0&&f<this._options.stickTopRows||this._options.stickBottomRows>0&&f>=this._rows.length-this._options.stickBottomRows)&&(e=!1)}e&&m(this._draggingRow,d,c),this._lastY=b}}}},a.prototype._end=function(){if(!this._draggingRow)return!0;this._options.tableClass&&t(this._table,this._options.tableClass),this._options.dragClass&&t(this._draggingRow,this._options.dragClass);var a=n(this._tbody,this._draggingRow);if(a!==this._oldIndex){var b=this._lastSort;this._lastSort={previous:b,newIndex:a,oldIndex:this._oldIndex},this._options.onDrop&&this._options.onDrop(this._tbody,this._draggingRow,a,this._oldIndex)}else this._options.onDragEnd&&this._options.onDragEnd(this._tbody,this._draggingRow,this._oldIndex);this._draggingRow=null,this._lastY=!1,this._touchId=null,this._ended=!0,p(this._table,"mousemove",this._mousemove),p(document.body,"mousemove",this._scrollListener),B&&(p(this._table,"touchmove",this._touchmove),p(document.body,"touchmove",this._scrollListener))},a.prototype.revert=function(){if(null!==this._lastSort){var a=this._lastSort,b=a.oldIndex,c=a.newIndex,d=this._tbody.rows,e=d.length-1;d.length>1&&(b<e?this._tbody.insertBefore(d[c],d[b+(c>b?0:1)]):this._tbody.appendChild(d[c])),this._lastSort=a.previous}},a.prototype.undo=a.prototype.revert,a.prototype.destroy=function(){this._table[C]=null,this._ended===!1&&this._end(),p(this._table,"mousedown",this._mousedown),p(document,"mouseup",this._mouseup),B&&(p(this._table,"touchstart",this._touchstart),p(this._table,"touchend",this._touchend))},a.revert=function(a,b){var c=j(a);if(null===c&&b===!1)throw new Error("Table not found.");c&&c.revert()},a.undo=a.revert,a.destroy=function(a,b){var c=j(a);if(null===c&&b===!1)throw new Error("Table not found.");c&&c.destroy()};var E=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){setTimeout(a,1e3/60)};return z&&(z.fn.extend({rowSorter:function(b){var c=[];return this.each(function(d,e){c.push(new a(e,b))}),1===c.length?c[0]:c}}),z.rowSorter={undo:a.undo,revert:a.revert,destroy:a.destroy}),a});